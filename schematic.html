<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selection Panel Prototyp – Schaltplan v7.5</title>
    <link rel="stylesheet" href="schematic.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1>Selection Panel Prototyp</h1>
        <p class="subtitle">Schaltplan v7.5 · ESP32-S3 XIAO · 74HC595 + CD4021B · KiCad 8.0.8</p>
        
        <div class="status-bar">
            <div class="status-item verified">
                <span class="dot"></span>
                <span>Hardware verifiziert ✓</span>
            </div>
            <div class="status-item phase-next">
                <span class="dot dot-red"></span>
                <span>Phase 8: 100-Button PCB</span>
            </div>
            <div class="status-item">
                <span>Stand: 2026-01-08</span>
            </div>
        </div>
    </header>

    <!-- Tabs -->
    <nav class="tabs">
        <button class="tab active" data-view="prototype">Prototyp 10×</button>
        <button class="tab" data-view="full">Vollausbau 100×</button>
        <button class="tab" data-view="timing">Timing CD4021B</button>
        <button class="tab" data-view="pinout-595">74HC595 Pins</button>
        <button class="tab" data-view="pinout-4021">CD4021B Pins</button>
    </nav>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Schematic Panel -->
        <section class="schematic-panel">
            
            <!-- View: Prototype -->
            <div id="prototype" class="view active">
                <svg viewBox="0 0 1000 620" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <marker id="arr1" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                            <path d="M0,0 L6,3 L0,6 Z" fill="var(--color-data)"/>
                        </marker>
                        <marker id="arr-clock" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                            <path d="M0,0 L6,3 L0,6 Z" fill="var(--color-clock)"/>
                        </marker>
                        <marker id="arr-latch" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                            <path d="M0,0 L6,3 L0,6 Z" fill="var(--color-latch)"/>
                        </marker>
                    </defs>
                    
                    <!-- Title -->
                    <text x="500" y="30" class="text-title">Selection Panel Prototyp · 10 LEDs · 10 Taster</text>
                    <text x="500" y="50" class="text-subtitle">ESP32-S3 XIAO + 2× 74HC595 (U1/U2) + 2× CD4021B (U3/U4)</text>
                    
                    <!-- ============================================================
                         ESP32-S3 XIAO (Mitte links)
                         ============================================================ -->
                    <g class="esp32-group">
                        <rect x="40" y="180" width="140" height="260" rx="8" class="chip-esp32"/>
                        <text x="110" y="210" class="text-chip-title">ESP32-S3</text>
                        <text x="110" y="230" class="text-chip-sub">XIAO</text>
                        
                        <!-- Rechte Seite: Pins -->
                        <text x="168" y="270" class="text-pin-right">D10</text>
                        <text x="168" y="300" class="text-pin-right">D8</text>
                        <text x="168" y="330" class="text-pin-right">D0</text>
                        <text x="168" y="360" class="text-pin-right">D2</text>
                        
                        <!-- Linke Seite: Pins -->
                        <text x="52" y="300" class="text-pin-left">D9</text>
                        <text x="52" y="330" class="text-pin-left">D1</text>
                        
                        <!-- Power -->
                        <text x="110" y="420" class="text-label-small">+5V / 3V3 / GND</text>
                    </g>
                    
                    <!-- ============================================================
                         Signal-Zuordnungs-Box
                         ============================================================ -->
                    <g transform="translate(200, 250)">
                        <rect x="0" y="0" width="120" height="140" rx="6" class="signal-box"/>
                        <text x="60" y="18" class="text-signal-box-title">Signale</text>
                        
                        <!-- LED Signale -->
                        <line x1="10" y1="38" x2="30" y2="38" class="wire-data" stroke-width="3"/>
                        <text x="38" y="42" class="text-signal-label">D10 MOSI</text>
                        
                        <line x1="10" y1="58" x2="30" y2="58" class="wire-clock" stroke-width="3"/>
                        <text x="38" y="62" class="text-signal-label">D8 SCK (shared)</text>
                        
                        <line x1="10" y1="78" x2="30" y2="78" class="wire-latch" stroke-width="3"/>
                        <text x="38" y="82" class="text-signal-label">D0 RCK</text>
                        
                        <!-- Trennlinie -->
                        <line x1="10" y1="95" x2="110" y2="95" stroke="var(--border)" stroke-width="1"/>
                        
                        <!-- BTN Signale -->
                        <line x1="10" y1="112" x2="30" y2="112" class="wire-data" stroke-width="3"/>
                        <text x="38" y="116" class="text-signal-label">D9 MISO</text>
                        
                        <line x1="10" y1="132" x2="30" y2="132" class="wire-latch" stroke-width="3"/>
                        <text x="38" y="136" class="text-signal-label">D1 P/S</text>
                    </g>
                    
                    <!-- ============================================================
                         Verbindungen ESP32 → Signal-Box
                         ============================================================ -->
                    <!-- D10 → MOSI -->
                    <path d="M 180 265 L 200 265 L 200 288" class="wire-data"/>
                    <!-- D8 → SCK -->
                    <path d="M 180 295 L 190 295 L 190 308 L 200 308" class="wire-clock"/>
                    <!-- D0 → RCK -->
                    <path d="M 180 325 L 185 325 L 185 328 L 200 328" class="wire-latch"/>
                    
                    <!-- ============================================================
                         Verbindungen Signal-Box → 74HC595
                         ============================================================ -->
                    <!-- MOSI → U1 SER -->
                    <path d="M 320 288 L 350 288 L 350 290 L 380 290" class="wire-data" marker-end="url(#arr1)"/>
                    <!-- SCK → Bus -->
                    <path d="M 320 308 L 340 308 L 340 450" class="wire-clock"/>
                    <!-- RCK → Bus -->
                    <path d="M 320 328 L 330 328 L 330 480" class="wire-latch"/>
                    
                    <!-- ============================================================
                         74HC595 U1 (8 LEDs: D1-D8)
                         ============================================================ -->
                    <g class="chip-595-group">
                        <rect x="380" y="180" width="130" height="160" rx="6" class="chip-595"/>
                        <text x="445" y="210" class="text-chip-title">74HC595</text>
                        <text x="445" y="228" class="text-chip-sub">U1 · LED 1-8</text>
                        
                        <!-- Pins links -->
                        <text x="392" y="260" class="text-pin-left">SER</text>
                        <text x="392" y="280" class="text-pin-left">SRCLK</text>
                        <text x="392" y="300" class="text-pin-left">RCLK</text>
                        <text x="392" y="320" class="text-pin-left">OE</text>
                        
                        <!-- Pins rechts -->
                        <text x="498" y="260" class="text-pin-right">QA-QH</text>
                        <text x="498" y="280" class="text-pin-right">QH'</text>
                    </g>
                    
                    <!-- LEDs von U1 -->
                    <g class="led-group">
                        <circle cx="540" cy="200" r="8" class="led"/>
                        <circle cx="560" cy="200" r="8" class="led"/>
                        <circle cx="580" cy="200" r="8" class="led"/>
                        <circle cx="600" cy="200" r="8" class="led"/>
                        <circle cx="620" cy="200" r="8" class="led"/>
                        <circle cx="640" cy="200" r="8" class="led"/>
                        <circle cx="660" cy="200" r="8" class="led"/>
                        <circle cx="680" cy="200" r="8" class="led"/>
                        <text x="610" y="180" class="text-label">LED 1-8</text>
                    </g>
                    
                    <!-- ============================================================
                         74HC595 U2 (2 LEDs: D9-D10)
                         ============================================================ -->
                    <g class="chip-595-group">
                        <rect x="380" y="360" width="130" height="120" rx="6" class="chip-595"/>
                        <text x="445" y="390" class="text-chip-title">74HC595</text>
                        <text x="445" y="408" class="text-chip-sub">U2 · LED 9-10</text>
                        
                        <!-- Pins -->
                        <text x="392" y="440" class="text-pin-left">SER</text>
                        <text x="498" y="440" class="text-pin-right">QA-QB</text>
                    </g>
                    
                    <!-- LEDs von U2 -->
                    <g class="led-group">
                        <circle cx="540" cy="380" r="8" class="led"/>
                        <circle cx="560" cy="380" r="8" class="led"/>
                        <text x="550" y="360" class="text-label">LED 9-10</text>
                    </g>
                    
                    <!-- Verbindung U1 QH' → U2 SER -->
                    <path d="M 510 275 L 530 275 L 530 340 L 360 340 L 360 435 L 380 435" class="wire-data" marker-end="url(#arr1)"/>
                    <text x="535" y="310" class="text-cascade">QH'→SER</text>
                    
                    <!-- ============================================================
                         CD4021B U3 (8 Taster: BTN 1-8)
                         ============================================================ -->
                    <g class="chip-4021-group">
                        <rect x="700" y="180" width="130" height="160" rx="6" class="chip-4021"/>
                        <text x="765" y="210" class="text-chip-title">CD4021B</text>
                        <text x="765" y="228" class="text-chip-sub">U3 · BTN 1-8</text>
                        
                        <!-- Pins links -->
                        <text x="712" y="260" class="text-pin-left">PI-8..1</text>
                        <text x="712" y="280" class="text-pin-left">CLK</text>
                        <text x="712" y="300" class="text-pin-left">P/S</text>
                        <text x="712" y="320" class="text-pin-left">DS</text>
                        
                        <!-- Pins rechts -->
                        <text x="818" y="260" class="text-pin-right">←BTN</text>
                        <text x="818" y="280" class="text-pin-right">Q8</text>
                    </g>
                    
                    <!-- Taster BTN 1-8 -->
                    <g class="btn-group">
                        <rect x="860" y="195" width="20" height="15" rx="2" class="btn-symbol"/>
                        <rect x="885" y="195" width="20" height="15" rx="2" class="btn-symbol"/>
                        <rect x="910" y="195" width="20" height="15" rx="2" class="btn-symbol"/>
                        <rect x="935" y="195" width="20" height="15" rx="2" class="btn-symbol"/>
                        <rect x="860" y="215" width="20" height="15" rx="2" class="btn-symbol"/>
                        <rect x="885" y="215" width="20" height="15" rx="2" class="btn-symbol"/>
                        <rect x="910" y="215" width="20" height="15" rx="2" class="btn-symbol"/>
                        <rect x="935" y="215" width="20" height="15" rx="2" class="btn-symbol"/>
                        <text x="900" y="180" class="text-label">BTN 1-8</text>
                    </g>
                    
                    <!-- ============================================================
                         CD4021B U4 (2 Taster: BTN 9-10)
                         ============================================================ -->
                    <g class="chip-4021-group">
                        <rect x="700" y="360" width="130" height="120" rx="6" class="chip-4021"/>
                        <text x="765" y="390" class="text-chip-title">CD4021B</text>
                        <text x="765" y="408" class="text-chip-sub">U4 · BTN 9-10</text>
                        
                        <!-- Pins -->
                        <text x="712" y="440" class="text-pin-left">DS</text>
                        <text x="818" y="440" class="text-pin-right">+3V3 ⚠</text>
                        <text x="712" y="460" class="text-pin-left">PI-8,7</text>
                    </g>
                    
                    <!-- Taster BTN 9-10 -->
                    <g class="btn-group">
                        <rect x="860" y="380" width="20" height="15" rx="2" class="btn-symbol"/>
                        <rect x="885" y="380" width="20" height="15" rx="2" class="btn-symbol"/>
                        <text x="875" y="365" class="text-label">BTN 9-10</text>
                    </g>
                    
                    <!-- Verbindung U4 Q8 → U3 DS -->
                    <path d="M 830 275 L 850 275 L 850 340 L 680 340 L 680 315 L 700 315" class="wire-data" marker-end="url(#arr1)"/>
                    <text x="855" y="310" class="text-cascade">Q8→DS</text>
                    
                    <!-- Verbindung U3 Q8 → ESP32 D9 -->
                    <path d="M 700 275 L 680 275 L 680 550 L 50 550 L 50 295 L 40 295" class="wire-data"/>
                    <text x="365" y="565" class="text-label">Q8 → D9 (MISO)</text>
                    
                    <!-- Clock Bus (SCK) -->
                    <path d="M 340 450 L 380 450" class="wire-clock" marker-end="url(#arr-clock)"/>
                    <path d="M 340 450 L 340 500 L 700 500 L 700 275" class="wire-clock"/>
                    <path d="M 700 500 L 700 420" class="wire-clock"/>
                    <text x="520" y="515" class="text-clock">SCK Bus (D8)</text>
                    
                    <!-- Latch Bus -->
                    <path d="M 330 480 L 380 480" class="wire-latch" marker-end="url(#arr-latch)"/>
                    <path d="M 330 480 L 330 530 L 690 530 L 690 295 L 700 295" class="wire-latch"/>
                    <path d="M 690 530 L 690 440" class="wire-latch"/>
                    <text x="520" y="545" class="text-latch">RCK (D0) / P/S (D1)</text>
                    
                    <!-- VCC für U4 DS -->
                    <path d="M 700 435 L 680 435 L 680 420" class="wire-vcc"/>
                    <text x="665" y="415" class="text-vcc">+3V3</text>
                    
                    <!-- Legende -->
                    <g transform="translate(40, 580)">
                        <text x="0" y="0" class="text-legend-title">Legende:</text>
                        <line x1="60" y1="-4" x2="90" y2="-4" class="wire-data" stroke-width="3"/>
                        <text x="95" y="0" class="text-legend">Data (MOSI/MISO)</text>
                        <line x1="200" y1="-4" x2="230" y2="-4" class="wire-clock" stroke-width="3"/>
                        <text x="235" y="0" class="text-legend">Clock (SCK)</text>
                        <line x1="320" y1="-4" x2="350" y2="-4" class="wire-latch" stroke-width="3"/>
                        <text x="355" y="0" class="text-legend">Latch/Load</text>
                        <line x1="440" y1="-4" x2="470" y2="-4" class="wire-vcc" stroke-width="3"/>
                        <text x="475" y="0" class="text-legend">VCC</text>
                    </g>
                </svg>
            </div>
            
            <!-- View: Full (100×) -->
            <div id="full" class="view">
                <svg viewBox="0 0 1000 600" xmlns="http://www.w3.org/2000/svg">
                    <text x="500" y="30" class="text-title">Selection Panel Vollausbau · 100 LEDs · 100 Taster</text>
                    <text x="500" y="50" class="text-subtitle">ESP32-S3 XIAO + 13× 74HC595 + 13× CD4021B</text>
                    
                    <!-- ESP32 -->
                    <rect x="40" y="200" width="100" height="180" rx="8" class="chip-esp32"/>
                    <text x="90" y="240" class="text-chip-title">ESP32-S3</text>
                    <text x="90" y="260" class="text-chip-sub">XIAO</text>
                    
                    <!-- 74HC595 Kette -->
                    <g transform="translate(180, 180)">
                        <rect x="0" y="0" width="80" height="60" rx="4" class="chip-595"/>
                        <text x="40" y="25" class="text-chip-sub">U1</text>
                        <text x="40" y="40" class="text-label-small">LED 1-8</text>
                        
                        <rect x="100" y="0" width="80" height="60" rx="4" class="chip-595"/>
                        <text x="140" y="25" class="text-chip-sub">U2</text>
                        <text x="140" y="40" class="text-label-small">LED 9-16</text>
                        
                        <text x="220" y="35" class="text-cascade">...</text>
                        
                        <rect x="260" y="0" width="80" height="60" rx="4" class="chip-595"/>
                        <text x="300" y="25" class="text-chip-sub">U13</text>
                        <text x="300" y="40" class="text-label-small">LED 97-100</text>
                        
                        <!-- Verbindungen -->
                        <path d="M 80 30 L 100 30" class="wire-data" marker-end="url(#arr1)"/>
                        <path d="M 180 30 L 200 30" class="wire-data"/>
                        <path d="M 240 30 L 260 30" class="wire-data" marker-end="url(#arr1)"/>
                    </g>
                    
                    <!-- CD4021B Kette -->
                    <g transform="translate(180, 320)">
                        <rect x="0" y="0" width="80" height="60" rx="4" class="chip-4021"/>
                        <text x="40" y="25" class="text-chip-sub">U14</text>
                        <text x="40" y="40" class="text-label-small">BTN 1-8</text>
                        
                        <rect x="100" y="0" width="80" height="60" rx="4" class="chip-4021"/>
                        <text x="140" y="25" class="text-chip-sub">U15</text>
                        <text x="140" y="40" class="text-label-small">BTN 9-16</text>
                        
                        <text x="220" y="35" class="text-cascade">...</text>
                        
                        <rect x="260" y="0" width="80" height="60" rx="4" class="chip-4021"/>
                        <text x="300" y="25" class="text-chip-sub">U26</text>
                        <text x="300" y="40" class="text-label-small">BTN 97-100</text>
                        
                        <!-- Verbindungen -->
                        <path d="M 100 30 L 80 30" class="wire-data" marker-end="url(#arr1)"/>
                        <path d="M 200 30 L 180 30" class="wire-data"/>
                        <path d="M 260 30 L 240 30" class="wire-data" marker-end="url(#arr1)"/>
                        
                        <!-- VCC am letzten -->
                        <text x="350" y="35" class="text-vcc">← DS = +3V3</text>
                    </g>
                    
                    <!-- Stückliste -->
                    <g transform="translate(550, 180)">
                        <rect x="0" y="0" width="200" height="200" rx="8" class="signal-box"/>
                        <text x="100" y="25" class="text-signal-box-title">Stückliste 100×</text>
                        
                        <text x="15" y="55" class="text-legend">ESP32-S3 XIAO</text>
                        <text x="175" y="55" class="text-legend">1×</text>
                        
                        <text x="15" y="75" class="text-legend">74HC595</text>
                        <text x="175" y="75" class="text-legend">13×</text>
                        
                        <text x="15" y="95" class="text-legend">CD4021B</text>
                        <text x="175" y="95" class="text-legend">13×</text>
                        
                        <text x="15" y="115" class="text-legend">LED 5mm</text>
                        <text x="175" y="115" class="text-legend">100×</text>
                        
                        <text x="15" y="135" class="text-legend">Taster 6×6mm</text>
                        <text x="175" y="135" class="text-legend">100×</text>
                        
                        <text x="15" y="155" class="text-legend">R 330Ω (LED)</text>
                        <text x="175" y="155" class="text-legend">100×</text>
                        
                        <text x="15" y="175" class="text-legend">R 10kΩ (Pull-up)</text>
                        <text x="175" y="175" class="text-legend">100×</text>
                        
                        <text x="15" y="195" class="text-legend">C 100nF</text>
                        <text x="175" y="195" class="text-legend">26×</text>
                    </g>
                    
                    <!-- Hinweis -->
                    <text x="500" y="550" class="text-subtitle">SPI-Transfer: 13 Bytes LEDs + 13 Bytes Buttons = 26 Bytes @ 500 kHz ≈ 420 µs</text>
                </svg>
            </div>
            
            <!-- View: Timing -->
            <div id="timing" class="view">
                <svg viewBox="0 0 900 500" xmlns="http://www.w3.org/2000/svg">
                    <text x="450" y="30" class="text-title">CD4021B Timing-Diagramm</text>
                    <text x="450" y="50" class="text-subtitle">MSB-first · Active-Low Buttons · First-Bit Rescue</text>
                    
                    <!-- Timing Signals -->
                    <g transform="translate(50, 80)">
                        <!-- P/S Signal -->
                        <text x="0" y="20" class="text-signal-label">P/S (D1)</text>
                        <path d="M 80 10 L 80 30 L 150 30 L 150 10 L 700 10" class="wire-latch" stroke-width="2" fill="none"/>
                        <text x="110" y="50" class="text-label-small">HIGH = Load</text>
                        <text x="400" y="50" class="text-label-small">LOW = Shift</text>
                        
                        <!-- CLK Signal -->
                        <text x="0" y="100" class="text-signal-label">CLK (D8)</text>
                        <path d="M 80 90 L 160 90 L 160 110 L 200 110 L 200 90 L 240 90 L 240 110 L 280 110 L 280 90 L 320 90 L 320 110 L 360 110 L 360 90 L 400 90 L 400 110 L 440 110 L 440 90 L 480 90 L 480 110 L 520 110 L 520 90 L 560 90 L 560 110 L 600 110 L 600 90 L 640 90 L 640 110 L 680 110 L 680 90 L 700 90" class="wire-clock" stroke-width="2" fill="none"/>
                        <text x="200" y="130" class="text-label-small">1</text>
                        <text x="280" y="130" class="text-label-small">2</text>
                        <text x="360" y="130" class="text-label-small">3</text>
                        <text x="440" y="130" class="text-label-small">4</text>
                        <text x="520" y="130" class="text-label-small">5</text>
                        <text x="600" y="130" class="text-label-small">6</text>
                        <text x="680" y="130" class="text-label-small">7</text>
                        
                        <!-- Q8 Data -->
                        <text x="0" y="180" class="text-signal-label">Q8 (D9)</text>
                        <path d="M 80 170 L 150 170" class="wire-data" stroke-width="2" fill="none"/>
                        <rect x="150" y="160" width="60" height="30" fill="rgba(81, 207, 102, 0.3)" stroke="var(--color-data)"/>
                        <text x="180" y="180" class="text-label-small">PI-1</text>
                        <rect x="210" y="160" width="80" height="30" fill="rgba(81, 207, 102, 0.3)" stroke="var(--color-data)"/>
                        <text x="250" y="180" class="text-label-small">PI-2</text>
                        <rect x="290" y="160" width="80" height="30" fill="rgba(81, 207, 102, 0.3)" stroke="var(--color-data)"/>
                        <text x="330" y="180" class="text-label-small">PI-3</text>
                        <text x="380" y="180" class="text-label-small">...</text>
                        <rect x="400" y="160" width="80" height="30" fill="rgba(81, 207, 102, 0.3)" stroke="var(--color-data)"/>
                        <text x="440" y="180" class="text-label-small">PI-8</text>
                        
                        <!-- First Bit Warning -->
                        <rect x="145" y="200" width="80" height="50" rx="4" fill="rgba(217, 119, 6, 0.2)" stroke="var(--warning)"/>
                        <text x="185" y="220" class="text-warning" style="font-size: 10px;">⚠ First Bit</text>
                        <text x="185" y="235" class="text-label-small">vor SPI lesen!</text>
                        
                        <!-- Explanation -->
                        <g transform="translate(0, 280)">
                            <rect x="80" y="0" width="620" height="100" rx="6" class="signal-box"/>
                            <text x="100" y="25" class="text-signal-box-title" style="text-anchor: start;">First-Bit Rescue (cd4021.cpp)</text>
                            <text x="100" y="50" class="text-legend" style="font-family: monospace;">1. P/S = HIGH → Parallel Load</text>
                            <text x="100" y="70" class="text-legend" style="font-family: monospace;">2. uint8_t firstBit = digitalRead(D9); // PI-1 sofort an Q8!</text>
                            <text x="100" y="90" class="text-legend" style="font-family: monospace;">3. SPI.transfer(buffer, n); // restliche Bits</text>
                        </g>
                    </g>
                </svg>
            </div>
            
            <!-- View: 74HC595 Pinout -->
            <div id="pinout-595" class="view">
                <div class="pinout-container">
                    <h2 class="pinout-title">74HC595 – 8-Bit Shift Register (Output)</h2>
                    <div class="pinout-grid">
                        <table class="pinout-table">
                            <thead>
                                <tr>
                                    <th>Pin</th>
                                    <th>Name</th>
                                    <th>Funktion</th>
                                    <th>U1 (LED 1-8)</th>
                                    <th>U2 (LED 9-10)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="pin-data"><td>1</td><td>QB</td><td>Output B</td><td class="led-active">→ LED 2 + R2</td><td class="led-active">→ LED 10 + R10</td></tr>
                                <tr class="pin-data"><td>2</td><td>QC</td><td>Output C</td><td class="led-active">→ LED 3 + R3</td><td class="led-inactive">(offen)</td></tr>
                                <tr class="pin-data"><td>3</td><td>QD</td><td>Output D</td><td class="led-active">→ LED 4 + R4</td><td class="led-inactive">(offen)</td></tr>
                                <tr class="pin-data"><td>4</td><td>QE</td><td>Output E</td><td class="led-active">→ LED 5 + R5</td><td class="led-inactive">(offen)</td></tr>
                                <tr class="pin-data"><td>5</td><td>QF</td><td>Output F</td><td class="led-active">→ LED 6 + R6</td><td class="led-inactive">(offen)</td></tr>
                                <tr class="pin-data"><td>6</td><td>QG</td><td>Output G</td><td class="led-active">→ LED 7 + R7</td><td class="led-inactive">(offen)</td></tr>
                                <tr class="pin-data"><td>7</td><td>QH</td><td>Output H</td><td class="led-active">→ LED 8 + R8</td><td class="led-inactive">(offen)</td></tr>
                                <tr class="pin-power"><td>8</td><td>GND</td><td>Masse</td><td>→ GND</td><td>→ GND</td></tr>
                                <tr class="pin-cascade"><td>9</td><td>QH'</td><td>Serial Out</td><td>→ U2 SER (Pin 14)</td><td class="pin-open">(offen OK)</td></tr>
                                <tr class="pin-control"><td>10</td><td>SRCLR</td><td>Clear (active-low)</td><td>→ +3,3V</td><td>→ +3,3V</td></tr>
                                <tr class="pin-clock"><td>11</td><td>SRCLK</td><td>Shift Clock</td><td>← D8 (SCK)</td><td>← D8 (SCK)</td></tr>
                                <tr class="pin-latch"><td>12</td><td>RCLK</td><td>Storage Clock</td><td>← D0 (RCK)</td><td>← D0 (RCK)</td></tr>
                                <tr class="pin-control"><td>13</td><td>OE</td><td>Output Enable</td><td>→ GND oder D2</td><td>→ GND oder D2</td></tr>
                                <tr class="pin-data"><td>14</td><td>SER</td><td>Serial Data In</td><td>← D10 (MOSI)</td><td>← U1 QH'</td></tr>
                                <tr class="pin-data"><td>15</td><td>QA</td><td>Output A</td><td class="led-active">→ LED 1 + R1</td><td class="led-active">→ LED 9 + R9</td></tr>
                                <tr class="pin-power"><td>16</td><td>VCC</td><td>Versorgung</td><td>→ +3,3V + C1 (100nF)</td><td>→ +3,3V + C2 (100nF)</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="pinout-notes">
                        <div class="note-box note-info">
                            <strong>LED-Widerstand:</strong> 330Ω – 3kΩ je nach gewünschter Helligkeit. Bei 330Ω: ~4 mA pro LED.
                        </div>
                        <div class="note-box note-cascade">
                            <strong>Kaskadierung:</strong> D10 (MOSI) → U1 SER → U1 QH' → U2 SER → U2 QH' → ...
                        </div>
                        <div class="note-box note-warning">
                            <strong>OE (Pin 13):</strong> GND = LEDs aktiv. Für PWM-Helligkeit: an D2 anschließen (active-low!).
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- View: CD4021B Pinout -->
            <div id="pinout-4021" class="view">
                <div class="pinout-container">
                    <h2 class="pinout-title">CD4021B – 8-Bit Shift Register (Input)</h2>
                    <div class="pinout-grid">
                        <table class="pinout-table">
                            <thead>
                                <tr>
                                    <th>Pin</th>
                                    <th>Name</th>
                                    <th>Funktion</th>
                                    <th>U3 (BTN 1-8)</th>
                                    <th>U4 (BTN 9-10)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="pin-input"><td>1</td><td>PI-8</td><td>Parallel Input 7</td><td class="btn-active">← BTN 1 + R11 (10kΩ)</td><td class="btn-active">← BTN 9 + R19 (10kΩ)</td></tr>
                                <tr class="pin-internal"><td>2</td><td>Q6</td><td>(interner Ausgang)</td><td>–</td><td>–</td></tr>
                                <tr class="pin-cascade"><td>3</td><td>Q8</td><td>Serial Data Out</td><td>→ D9 (MISO)</td><td>→ U3 DS (Pin 11)</td></tr>
                                <tr class="pin-input"><td>4</td><td>PI-4</td><td>Parallel Input 3</td><td class="btn-active">← BTN 5 + R15 (10kΩ)</td><td class="btn-inactive">(+3,3V)</td></tr>
                                <tr class="pin-input"><td>5</td><td>PI-3</td><td>Parallel Input 2</td><td class="btn-active">← BTN 6 + R16 (10kΩ)</td><td class="btn-inactive">(+3,3V)</td></tr>
                                <tr class="pin-input"><td>6</td><td>PI-2</td><td>Parallel Input 1</td><td class="btn-active">← BTN 7 + R17 (10kΩ)</td><td class="btn-inactive">(+3,3V)</td></tr>
                                <tr class="pin-input"><td>7</td><td>PI-1</td><td>Parallel Input 0</td><td class="btn-active">← BTN 8 + R18 (10kΩ)</td><td class="btn-inactive">(+3,3V)</td></tr>
                                <tr class="pin-power"><td>8</td><td>VSS</td><td>Masse</td><td>→ GND</td><td>→ GND</td></tr>
                                <tr class="pin-latch"><td>9</td><td>P/S (PL)</td><td>Load Control ⚠</td><td>← D1 (P/S)</td><td>← D1 (P/S)</td></tr>
                                <tr class="pin-clock"><td>10</td><td>CLK (CP)</td><td>Clock</td><td>← D8 (SCK)</td><td>← D8 (SCK)</td></tr>
                                <tr class="pin-cascade"><td>11</td><td>DS</td><td>Serial Data In</td><td>← U4 Q8</td><td class="pin-vcc">→ +3,3V ⚠</td></tr>
                                <tr class="pin-internal"><td>12</td><td>Q7</td><td>(interner Ausgang)</td><td>–</td><td>–</td></tr>
                                <tr class="pin-input"><td>13</td><td>PI-5</td><td>Parallel Input 4</td><td class="btn-active">← BTN 4 + R14 (10kΩ)</td><td class="btn-inactive">(+3,3V)</td></tr>
                                <tr class="pin-input"><td>14</td><td>PI-6</td><td>Parallel Input 5</td><td class="btn-active">← BTN 3 + R13 (10kΩ)</td><td class="btn-inactive">(+3,3V)</td></tr>
                                <tr class="pin-input"><td>15</td><td>PI-7</td><td>Parallel Input 6</td><td class="btn-active">← BTN 2 + R12 (10kΩ)</td><td class="btn-active">← BTN 10 + R20 (10kΩ)</td></tr>
                                <tr class="pin-power"><td>16</td><td>VDD</td><td>Versorgung</td><td>→ +3,3V + C3 (100nF)</td><td>→ +3,3V + C4 (100nF)</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="pinout-notes">
                        <div class="note-box note-warning">
                            <strong>⚠ Wichtig:</strong> DS (Pin 11) am letzten IC (U4) muss auf +3,3V – CMOS-Eingänge dürfen nicht floaten!
                        </div>
                        <div class="note-box note-warning">
                            <strong>⚠ Ungenutzte Pins:</strong> Alle unbenutzten PI-x von U4 müssen auf +3,3V (nicht offen lassen).
                        </div>
                        <div class="note-box note-cascade">
                            <strong>Kaskadierung:</strong> +3,3V → U4 DS → U4 Q8 → U3 DS → U3 Q8 → D9 (MISO)
                        </div>
                        <div class="note-box note-info">
                            <strong>Taster-Verdrahtung:</strong> BTN 1 → PI-8 (Pin 1), BTN 8 → PI-1 (Pin 7). Active-Low mit 10kΩ Pull-up.
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Pin Table - Korrigiert -->
            <div class="card card-primary">
                <h3>ESP32-S3 XIAO Pinbelegung</h3>
                <table class="pin-table">
                    <thead>
                        <tr><th>Pin</th><th>Signal</th><th>Ziel</th></tr>
                    </thead>
                    <tbody>
                        <tr><td class="pin-num">D10</td><td class="signal-out">MOSI</td><td>→ U1 SER</td></tr>
                        <tr><td class="pin-num">D8</td><td class="signal-out">SCK</td><td>→ alle CLK (shared)</td></tr>
                        <tr><td class="pin-num">D0</td><td class="signal-out">RCK</td><td>→ U1/U2 RCLK</td></tr>
                        <tr><td class="pin-num">D2</td><td class="signal-out">OE</td><td>→ U1/U2 OE (PWM)</td></tr>
                        <tr><td class="pin-num">D9</td><td class="signal-in">MISO</td><td>← U3 Q8</td></tr>
                        <tr><td class="pin-num">D1</td><td class="signal-out">P/S</td><td>→ U3/U4 P/S</td></tr>
                    </tbody>
                </table>
            </div>
            
            <!-- 74HC595 Summary -->
            <div class="card card-accent">
                <h3>74HC595 (Output)</h3>
                <p class="note" style="margin-bottom: 0.5rem; font-style: normal;">U1: 8× LED · U2: 2× LED</p>
                <table class="pin-table">
                    <thead>
                        <tr><th>Pin</th><th>Name</th><th>Verbindung</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>14</td><td>SER</td><td>← MOSI / QH'</td></tr>
                        <tr><td>11</td><td>SRCLK</td><td>← SCK (D8)</td></tr>
                        <tr><td>12</td><td>RCLK</td><td>← RCK (D0)</td></tr>
                        <tr><td>9</td><td>QH'</td><td>→ nächster SER</td></tr>
                        <tr><td>10</td><td>SRCLR</td><td>→ +3,3V</td></tr>
                        <tr><td>13</td><td>OE</td><td>→ GND oder D2</td></tr>
                        <tr><td>16</td><td>VCC</td><td>→ +3,3V + 100nF</td></tr>
                        <tr><td>8</td><td>GND</td><td>→ GND</td></tr>
                    </tbody>
                </table>
                <p class="note">SPI: MODE0, 1 MHz</p>
            </div>
            
            <!-- CD4021B Summary -->
            <div class="card card-secondary">
                <h3>CD4021B (Input)</h3>
                <p class="note" style="margin-bottom: 0.5rem; font-style: normal;">U3: 8× BTN · U4: 2× BTN</p>
                <table class="pin-table">
                    <thead>
                        <tr><th>Pin</th><th>Name</th><th>Verbindung</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>3</td><td>Q8</td><td>→ MISO / DS</td></tr>
                        <tr><td>10</td><td>CLK</td><td>← SCK (D8)</td></tr>
                        <tr><td>9</td><td class="signal-warning">P/S</td><td>← P/S (D1)</td></tr>
                        <tr><td>11</td><td>DS</td><td>← Q8 / <strong>+3V3</strong></td></tr>
                        <tr><td>16</td><td>VDD</td><td>→ +3,3V + 100nF</td></tr>
                        <tr><td>8</td><td>VSS</td><td>→ GND</td></tr>
                    </tbody>
                </table>
                <p class="note">SPI: MODE1, 500 kHz</p>
            </div>
            
            <!-- Warning -->
            <div class="card card-warning">
                <h3>⚠ Wichtige Hinweise</h3>
                <table class="pin-table">
                    <thead>
                        <tr><th>Thema</th><th>Regel</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>CD4021B DS</td><td class="signal-warning">letzter → +3V3 ⚠</td></tr>
                        <tr><td>Ungenutzte PI</td><td class="signal-warning">→ +3V3 ⚠</td></tr>
                        <tr><td>74HC595 QH'</td><td class="signal-ok">offen OK ✓</td></tr>
                        <tr><td>First Bit</td><td class="signal-warning">vor SPI lesen ⚠</td></tr>
                    </tbody>
                </table>
                <p class="note">CMOS-Eingänge nie floaten lassen!</p>
            </div>
            
            <!-- BOM Prototype - Korrigiert -->
            <div class="card">
                <h3>Stückliste (Prototyp 10×)</h3>
                <ul class="bom-list">
                    <li><span>ESP32-S3 XIAO</span><span class="count">1×</span></li>
                    <li><span>74HC595 (U1: 8 LED, U2: 2 LED)</span><span class="count">2×</span></li>
                    <li><span>CD4021B (U3: 8 BTN, U4: 2 BTN)</span><span class="count">2×</span></li>
                    <li><span>LED 5mm (D1-D10)</span><span class="count">10×</span></li>
                    <li><span>R 330Ω – 3kΩ (R1-R10, LED)</span><span class="count">10×</span></li>
                    <li><span>Taster 6×6mm (SW1-SW10)</span><span class="count">10×</span></li>
                    <li><span>R 10kΩ (R11-R20, Pull-up)</span><span class="count">10×</span></li>
                    <li><span class="capacitor">C 100nF (C1-C4, je IC)</span><span class="count capacitor">4×</span></li>
                </ul>
            </div>
        </aside>
    </main>
    
    <!-- Footer -->
    <footer class="footer">
        <span>Selection Panel v7.5 · KiCad 8.0.8 · Firmware v2.5.2</span>
        <span>Jan Unger · 2026-01-08</span>
    </footer>
    
    <script src="schematic.js"></script>
</body>
</html>
